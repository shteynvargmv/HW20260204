# Spring Security JWT Demo Project

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Spring Boot –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Spring Security –∏ JWT (JSON Web Tokens).

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç REST API —Å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º–∏ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º–∏. –î–æ—Å—Ç—É–ø –∫ —Ä–µ—Å—É—Ä—Å–∞–º —Ä–µ–≥—É–ª–∏—Ä—É–µ—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–æ–ª–µ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (`USER`, `ADMIN`). –í–º–µ—Å—Ç–æ —Å–µ—Å—Å–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Stateless –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å JWT —Ç–æ–∫–µ–Ω–∞–º–∏.

### –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
*   –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É (Register, Login (c –ø–æ–ª—É—á–µ–Ω–∏–º JWT —Ç–æ–∫–µ–Ω–∞), Logout).
*   –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ.
*   –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ –∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –ø–æ —Ä–æ–ª—è–º.
*   –•—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î.

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
*   Java 17 –∏–ª–∏ –≤—ã—à–µ
*   Maven (–≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π wrapper `mvnw` –≤–∫–ª—é—á–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç)

### –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –∑–∞–ø—É—Å–∫—É
1.  –û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–µ –ø—Ä–æ–µ–∫—Ç–∞.
2.  –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥–æ–π:
    ```bash
    ./mvnw spring-boot:run
    ```
    (–î–ª—è Windows: `mvnw.cmd spring-boot:run`)
3.  –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç—É `8088`.

---

## üõ† –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Postman, cURL –∏–ª–∏ –ª—é–±–æ–π –¥—Ä—É–≥–æ–π HTTP –∫–ª–∏–µ–Ω—Ç.

### 1. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
–û—Ç–ø—Ä–∞–≤—å—Ç–µ POST –∑–∞–ø—Ä–æ—Å.

*   **URL:** `http://localhost:8088/auth/register`
*   **Method:** `POST`
*   **Body (JSON):**
    ```json
    {
        "username": "user1",
        "password": "password",
        "email" : "mail@mail.ru",
        "role" : 0
    }
    ```
    –†–æ–ª—å: 0 –¥–ª—è USER (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é), 1 –¥–ª—è ADMIN

### 2. –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (–ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞)
–û—Ç–ø—Ä–∞–≤—å—Ç–µ POST –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞.

*   **URL:** `http://localhost:8088/auth/login`
*   **Method:** `POST`
*   **Body (JSON):**
    ```json
    {
        "username": "user1",
        "password": "password"
    }
    ```

*   **–û—Ç–≤–µ—Ç:** –°—Ç—Ä–æ–∫–∞ —Å JWT —Ç–æ–∫–µ–Ω–æ–º (–Ω–∞–ø—Ä–∏–º–µ—Ä, `eyJhbGciOiJIUzI1NiJ9...`).

### 3. –î–æ—Å—Ç—É–ø –∫ –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Ä–µ—Å—É—Ä—Å–∞–º
–î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –ª—é–±—ã–º –¥—Ä—É–≥–∏–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ `Authorization`.

*   **Header:** `Authorization`
*   **Value:** `Bearer <–í–ê–®_–¢–û–ö–ï–ù>`

### –°–ø–∏—Å–æ–∫ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

| –ú–µ—Ç–æ–¥  | URL                | –ù–µ–æ–±—Ö–æ–¥–∏–º–∞—è —Ä–æ–ª—å      | –û–ø–∏—Å–∞–Ω–∏–µ                                  |
|--------|--------------------|-----------------------|-------------------------------------------|
| `GET`  | `/`                | –õ—é–±–∞—è (Authenticated) | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ —Ä–æ–ª—å.   |
| `POST` | `/auth/register`   | –î–ª—è –≤—Å–µ—Ö              | Authentication –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è               |
| `POST` | `/auth/login`      | –î–ª—è –≤—Å–µ—Ö              | Authentication –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è               |
| `POST` | `/auth/logout`     | –õ—é–±–∞—è (Authenticated) | –î–æ—Å—Ç—É–ø–Ω–æ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ –∞–¥–º–∏–Ω–∞–º. |
| `GET`  | `/user/me`         | `USER` –∏–ª–∏ `ADMIN`    | –î–æ—Å—Ç—É–ø–Ω–æ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ –∞–¥–º–∏–Ω–∞–º. |
| `GET`  | `/user/dashboard`  | `USER` –∏–ª–∏ `ADMIN`    | –î–æ—Å—Ç—É–ø–Ω–æ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ –∞–¥–º–∏–Ω–∞–º. |
| `GET`  | `/user/profile`    | `USER` –∏–ª–∏ `ADMIN`    | –î–æ—Å—Ç—É–ø–Ω–æ –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ –∞–¥–º–∏–Ω–∞–º. |
| `GET`  | `/admin/me`        | `ADMIN`               | –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º.                  |
| `GET`  | `/admin/dashboard` | `ADMIN`               | –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º.                  |
| `GET`  | `/admin/users`     | `ADMIN`               | –î–æ—Å—Ç—É–ø–Ω–æ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∞–º.                  |

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞ cURL:**
```bash
curl -H "Authorization: Bearer <–í–ê–®_–¢–û–ö–ï–ù>" http://localhost:8088/admin
```

---

## ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞

### 1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ/–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
–°–º. –º–µ—Ç–æ–¥ `userService()`:

```java
public User register(User user) {
    System.out.println("ok");
    if (userRepository.findByUsername(user.getUsername()).isPresent()) {
        throw new RuntimeException("User already exists");
    }

    user.setPassword(passwordEncoder.encode(user.getPassword()));

    if (user.getRole() == null) {
        user.setRole(Role.USER);
    }

    System.out.println(user);

    return userRepository.save(user);
}
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (Endpoint Security)
–ü—Ä–∞–≤–∏–ª–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ URL –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `ru.top.security.config.SecurityConfig` –≤ –º–µ—Ç–æ–¥–µ `securityFilterChain()`:

```java
http.csrf(csrf -> csrf.disable())
        .authorizeHttpRequests((authorize) -> authorize
        .requestMatchers("/auth/login", "/auth/register").permitAll()
        .requestMatchers("/admin/**").hasRole("ADMIN")
        .requestMatchers("/user/**").hasAnyRole("USER", "ADMIN")
        .requestMatchers("/auth/logout").authenticated()
        .anyRequest().authenticated()
)
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ JWT (–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è –∏ –°–µ–∫—Ä–µ—Ç)
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã JWT –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –∫–ª–∞—Å—Å–µ `ru.top.security.jwt.JwtUtil`.

*   **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á:** –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è `SECRET`. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ª–æ–∂–Ω—ã–º –∏ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.
*   **–°—Ä–æ–∫ –¥–µ–π—Å—Ç–≤–∏—è:** –í –º–µ—Ç–æ–¥–µ `createToken` (—Å—Ç—Ä–æ–∫–∞ `.setExpiration(...)`).
    ```java
    // –ü—Ä–∏–º–µ—Ä: 30 –º–∏–Ω—É—Ç
    .setExpiration(new Date(System.currentTimeMillis() + 1000 * 60 * 30))
    ```

### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
–°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –∫–ª–∞—Å—Å –≤ –ø–∞–∫–µ—Ç–µ `controller`.

```java
@RestController
public class ProductController {
    @GetMapping("/products")
    public String getProducts() {
        return "List of products";
    }
}
```
–ù–µ –∑–∞–±—É–¥—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–æ–≤–æ–º—É –ø—É—Ç–∏ –≤ `SecurityConfig`, –∏–Ω–∞—á–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ–Ω –±—É–¥–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ –ª—é–±–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
